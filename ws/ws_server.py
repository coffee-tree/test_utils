import asyncio
import websockets
import json

pos = [
    [37.5502, 127.0743],  # 세종대
    [37.55003333, 127.0744],
    [37.54986667, 127.0745],
    [37.5497, 127.0746],
    [37.54953333, 127.0747],
    [37.54936667, 127.0748],
    [37.5492, 127.0749],
    [37.54903333, 127.075],
    [37.54886667, 127.0751],
    [37.5487, 127.0752],
    [37.5487, 127.0752],
    [37.54854444, 127.0750778],
    [37.54838889, 127.0749556],
    [37.54823333, 127.0748333],
    [37.54807778, 127.0747111],
    [37.54792222, 127.0745889],
    [37.54776667, 127.0744667],
    [37.54761111, 127.0743444],
    [37.54745556, 127.0742222],
    [37.5473, 127.0741],
    [37.5473, 127.0741],
    [37.5469, 127.0739111],
    [37.5465, 127.0737222],
    [37.5461, 127.0735333],
    [37.5457, 127.0733444],
    [37.5453, 127.0731556],
    [37.5449, 127.0729667],
    [37.5445, 127.0727778],
    [37.5441, 127.0725889],
    [37.5437, 127.0724],
    [37.5437, 127.0724],
    [37.54362578, 127.0729111],
    [37.54355156, 127.0734222],
    [37.54347733, 127.0739333],
    [37.54340311, 127.0744444],
    [37.54332889, 127.0749556],
    [37.54325467, 127.0754667],
    [37.54318044, 127.0759778],
    [37.54310622, 127.0764889],
    [37.543032, 127.077],
    [37.543032, 127.077],  # 건대
]


async def server(websocket, path):
    print(f"connect client: {websocket.remote_address}")

    idx = 0

    while True:
        x, y = pos[idx]

        message = json.dumps({"x": x, "y": y})

        await websocket.send(message)
        print(f"msg: {message}")

        idx = (idx + 1) % len(pos)

        await asyncio.sleep(1)


start_server = websockets.serve(server, "0.0.0.0", 6789)

asyncio.get_event_loop().run_until_complete(start_server)
asyncio.get_event_loop().run_forever()
